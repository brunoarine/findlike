 name: Publish Python Package                                                                                                                                              
                                                                                                                                                                           
 on:                                                                                                                                                                       
   push:                                                                                                                                                                   
     tags:                                                                                                                                                                 
       - 'v*'                                                                                                                                                              
     branches:                                                                                                                                                             
       - main                                                                                                                                                              
                                                                                                                                                                           
 jobs:                                                                                                                                                                     
   build-and-publish:                                                                                                                                                      
     runs-on: ubuntu-latest
     environment: pypi
     permissions:
      id-token: write
                                                                                                                                                                           
     steps:                                                                                                                                                                
     - name: Checkout code                                                                                                                                                 
       uses: actions/checkout@v4                                                                                                                                           
                                                                                                                                                                           
     - name: Set up Python                                                                                                                                                 
       uses: actions/setup-python@v5                                                                                                                                       
       with:                                                                                                                                                               
         python-version: '3.11'                                                                                                                                            
                                                                                                                                                                           
     - name: Install build tools                                                                                                                                           
       run: |                                                                                                                                                              
         python -m pip install --upgrade pip                                                                                                                               
         python -m pip install build twine                                                                                                                                        
                                                                                                                                                                           
     - name: Build package                                                                                                                                                 
       run: make build

     - name: Publish to PyPI
       uses: pypa/gh-action-pypi-publish@release/v1
                                                                                                                                                                           
     - name: Create GitHub Release                                                                                                                                         
       uses: softprops/action-gh-release@v2                                                                                                                                
       with:                                                                                                                                                               
         name: ${{ github.ref_name }}                                                                                                                              
         tag_name: ${{ github.ref }}
         draft: false
         prerelease: false
         body: |                                                                                                                                                           
           Release ${{ github.ref_name }}                                                                                                                                  
           - Built from ${{ github.sha }}                                                                                                                                  
           - Published to PyPI                                                                                                                                             
       env:                                                                                                                                                                
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 