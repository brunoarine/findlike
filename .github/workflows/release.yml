 name: Publish Python Package                                                                                                                                              
                                                                                                                                                                           
 on:                                                                                                                                                                       
   push:                                                                                                                                                                   
     tags:                                                                                                                                                                 
       - 'v*'                                                                                                                                                              
     branches:                                                                                                                                                             
       - main                                                                                                                                                              
                                                                                                                                                                           
 jobs:                                                                                                                                                                     
   build-and-publish:                                                                                                                                                      
     runs-on: ubuntu-latest                                                                                                                                                
                                                                                                                                                                           
     steps:                                                                                                                                                                
     - name: Checkout code                                                                                                                                                 
       uses: actions/checkout@v4                                                                                                                                           
                                                                                                                                                                           
     - name: Set up Python                                                                                                                                                 
       uses: actions/setup-python@v5                                                                                                                                       
       with:                                                                                                                                                               
         python-version: '3.11'                                                                                                                                            
                                                                                                                                                                           
     - name: Install build tools                                                                                                                                           
       run: |                                                                                                                                                              
         python -m pip install --upgrade pip                                                                                                                               
         pip install uv                                                                                                                                                    
         uv pip install --system build twine                                                                                                                                        
                                                                                                                                                                           
     - name: Build package                                                                                                                                                 
       run: uv pip build .                                                                                                                                                 
                                                                                                                                                                           
     - name: Publish to PyPI                                                                                                                                               
       env:                                                                                                                                                                
         TWINE_USERNAME: __token__                                                                                                                                         
         TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}                                                                                                                     
       run: twine upload dist/*                                                                                                                                            
                                                                                                                                                                           
     - name: Create GitHub Release                                                                                                                                         
       uses: softprops/action-gh-release@v1                                                                                                                                
       with:                                                                                                                                                               
         name: Release ${{ github.ref_name }}                                                                                                                              
         tag_name: ${{ github.ref }}                                                                                                                                       
         body: |                                                                                                                                                           
           Release ${{ github.ref_name }}                                                                                                                                  
           - Built from ${{ github.sha }}                                                                                                                                  
           - Published to PyPI                                                                                                                                             
       env:                                                                                                                                                                
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 